<?xml version="1.0" encoding="utf-8"?>
<odoo>
    <data>

        <!-- Employee List View -->
        <record id="view_hr_anonymous_message_list_employee" model="ir.ui.view">
            <field name="name">hr.anonymous.message.list.employee</field>
            <field name="model">hr.anonymous.message</field>
            <field name="priority">20</field>
            <field name="arch" type="xml">
                <list string="My Anonymous Messages" create="1" edit="0" delete="0">
                    <field name="create_date" string="Sent Date"/>
                    <field name="category"/>
                    <field name="name" string="Subject"/>
                    <field name="priority" widget="priority"/>
                    <field name="state" widget="badge"/>
                    <field name="create_uid"/>
                </list>
            </field>
        </record>

        <!-- Employee Form View -->
        <record id="view_hr_anonymous_message_form_employee" model="ir.ui.view">
            <field name="name">hr.anonymous.message.form.employee</field>
            <field name="model">hr.anonymous.message</field>
            <field name="priority">20</field>
            <field name="arch" type="xml">
                <form string="My Anonymous Message" create="1" edit="1" delete="0">
                    <header>
                        <button name="send_to_hr" string="Send to HR" type="object" 
                                class="oe_highlight" 
                                invisible="state != 'draft'"/>
                        <button name="action_close_ticket" string="Close This Message" type="object" 
                                confirm="Are you sure you want to close this message?"
                                invisible="state in ['draft', 'closed']"/>
                        <field name="state" widget="statusbar" readonly="1"/>
                    </header>
                    <sheet>
                        <group>
                            <group>
                                <field name="category" required="1" readonly="state != 'draft'"/>
                                <field name="priority" widget="priority" readonly="state != 'draft'"/>
                            </group>
                            <group invisible="state == 'draft'">
                                <field name="create_date" string="Sent On" readonly="1"/>
                            </group>
                        </group>
                        <group>
                            <field name="name" placeholder="Brief subject (e.g., 'Workplace concern')" 
                                   required="1" readonly="state != 'draft'"/>
                        </group>
                        <notebook>
                            <page string="Your Message">
                                <field name="description" widget="html" 
                                       placeholder="Write your detailed anonymous message here."
                                       required="1"
                                       readonly="state != 'draft'"/>
                            </page>
                            <page string="Resolution" invisible="state not in ['resolved', 'declined']">
                                <group>
                                    <field name="resolution_notes" readonly="1" nolabel="1"/>
                                </group>
                            </page>
                        </notebook>
                        
                        <field name="is_closed_by_employee" invisible="1"/>
                        <field name="is_my_message" invisible="1"/>
                        <field name="mail_sent" invisible="1"/>
                        <field name="closed_date" invisible="1"/>
                    </sheet>
                </form>
            </field>
        </record>

        <!-- HR List View -->
        <record id="view_hr_anonymous_message_list_hr" model="ir.ui.view">
            <field name="name">hr.anonymous.message.list.hr</field>
            <field name="model">hr.anonymous.message</field>
            <field name="priority">10</field>
            <field name="arch" type="xml">
                <list string="All Anonymous Messages" create="0" edit="1" delete="0">
                    <field name="create_date" string="Received"/>
                    <field name="category"/>
                    <field name="name" string="Subject"/>
                    <field name="priority" widget="priority"/>
                    <field name="state" widget="badge"/>
                    <field name="is_closed_by_employee"/>
                </list>
            </field>
        </record>

        <!-- HR Form View -->
        <record id="view_hr_anonymous_message_form_hr" model="ir.ui.view">
            <field name="name">hr.anonymous.message.form.hr</field>
            <field name="model">hr.anonymous.message</field>
            <field name="priority">10</field>
            <field name="arch" type="xml">
                <form string="Anonymous Message Management" create="0" edit="1" delete="0">
                    <header>
                        <button name="action_acknowledge" string="Acknowledge" type="object" 
                                class="oe_highlight" 
                                invisible="state != 'sent'" 
                                groups="hr.group_hr_user"/>
                        <button name="action_in_progress" string="In Progress" type="object" 
                                invisible="state not in ['sent', 'acknowledged']" 
                                groups="hr.group_hr_user"/>
                        <button name="action_resolve" string="Resolve" type="object" 
                                class="oe_highlight" 
                                invisible="state != 'in_progress'" 
                                groups="hr.group_hr_user"/>
                        <button name="action_decline" string="Decline" type="object" 
                                confirm="Add resolution notes explaining why." 
                                invisible="state not in ['sent', 'acknowledged', 'in_progress']" 
                                groups="hr.group_hr_user"/>
                        <field name="state" widget="statusbar"/>
                    </header>
                    <sheet>
                        <group>
                            <group>
                                <field name="category" readonly="1"/>
                                <field name="priority" widget="priority" readonly="1"/>
                                <field name="create_date" string="Received On" readonly="1"/>
                            </group>
                            <group>
                                <field name="is_closed_by_employee"/>
                                <field name="mail_sent"/>
                            </group>
                        </group>
                        <group>
                            <field name="name" readonly="1"/>
                        </group>
                        <notebook>
                            <page string="Message">
                                <field name="description" widget="html" readonly="1"/>
                            </page>
                            <page string="HR Notes" groups="hr.group_hr_user">
                                <field name="hr_notes" placeholder="Internal notes for HR team only"/>
                            </page>
                            <page string="Resolution" groups="hr.group_hr_user">
                                <field name="resolution_notes" placeholder="Explain the resolution or reason for declining"/>
                            </page>
                        </notebook>
                        <field name="closed_date" invisible="1"/>
                    </sheet>
                    <chatter/>
                </form>
            </field>
        </record>

        <!-- Admin List View -->
        <record id="view_hr_anonymous_message_list_admin" model="ir.ui.view">
            <field name="name">hr.anonymous.message.list.admin</field>
            <field name="model">hr.anonymous.message</field>
            <field name="priority">5</field>
            <field name="arch" type="xml">
                <list string="All Messages (Admin)" create="0" edit="1" delete="1">
                    <field name="create_date"/>
                    <field name="category"/>
                    <field name="name"/>
                    <field name="priority" widget="priority"/>
                    <field name="state" widget="badge"/>
                    <field name="is_closed_by_employee"/>
                    <field name="sender_audit_hash" optional="hide"/>
                </list>
            </field>
        </record>

        <!-- Admin Form View -->
        <record id="view_hr_anonymous_message_form_admin" model="ir.ui.view">
            <field name="name">hr.anonymous.message.form.admin</field>
            <field name="model">hr.anonymous.message</field>
            <field name="priority">5</field>
            <field name="arch" type="xml">
                <form string="Anonymous Message (Admin)" create="0" edit="1" delete="1">
                    <header>
                        <button name="action_acknowledge" string="Acknowledge" type="object" 
                                invisible="state != 'sent'" 
                                groups="base.group_system"/>
                        <button name="action_in_progress" string="In Progress" type="object" 
                                invisible="state not in ['sent', 'acknowledged']" 
                                groups="base.group_system"/>
                        <button name="action_resolve" string="Resolve" type="object" 
                                invisible="state != 'in_progress'" 
                                groups="base.group_system"/>
                        <button name="action_decline" string="Decline" type="object" 
                                invisible="state not in ['sent', 'acknowledged', 'in_progress']" 
                                groups="base.group_system"/>
                        <field name="state" widget="statusbar"/>
                    </header>
                    <sheet>
                        <group>
                            <group>
                                <field name="category"/>
                                <field name="priority" widget="priority"/>
                                <field name="create_date"/>
                            </group>
                            <group>
                                <field name="is_closed_by_employee"/>
                                <field name="mail_sent"/>
                                <field name="sender_audit_hash" readonly="1" groups="base.group_system"/>
                            </group>
                        </group>

                        <group>
                            <field name="name" readonly="1"/>
                        </group>
                        <notebook>
                            <page string="Message">
                                <field name="description" widget="html" readonly="1"/>
                            </page>
                            <page string="HR Notes">
                                <field name="hr_notes"/>
                            </page>
                            <page string="Resolution">
                                <field name="resolution_notes"/>
                            </page>
                        </notebook>
                        <field name="closed_date" invisible="1"/>
                    </sheet>
                    <chatter/>
                </form>
            </field>
        </record>

        <!-- Actions -->
        <record id="action_hr_anonymous_message_employee" model="ir.actions.act_window">
            <field name="name">My Anonymous Messages</field>
            <field name="res_model">hr.anonymous.message</field>
            <field name="view_mode">list,form</field>
            <field name="domain">[('is_my_message','=',True)]</field>
            <field name="context">{'default_state': 'draft'}</field>
            <field name="help" type="html">
                <p class="o_view_nocontent_smiling_face">
                    Create your first anonymous message
                </p>
                <p>
                    Submit anonymous messages to HR about workplace concerns,<br/>
                    suggestions, or any sensitive matters safely and confidentially.
                </p>
            </field>
        </record>

        <record id="action_hr_anonymous_message_employee_view_list" model="ir.actions.act_window.view">
            <field name="sequence" eval="1"/>
            <field name="view_mode">list</field>
            <field name="view_id" ref="view_hr_anonymous_message_list_employee"/>
            <field name="act_window_id" ref="action_hr_anonymous_message_employee"/>
        </record>

        <record id="action_hr_anonymous_message_employee_view_form" model="ir.actions.act_window.view">
            <field name="sequence" eval="2"/>
            <field name="view_mode">form</field>
            <field name="view_id" ref="view_hr_anonymous_message_form_employee"/>
            <field name="act_window_id" ref="action_hr_anonymous_message_employee"/>
        </record>

        <record id="action_hr_anonymous_message_hr" model="ir.actions.act_window">
            <field name="name">Anonymous Messages (HR)</field>
            <field name="res_model">hr.anonymous.message</field>
            <field name="view_mode">list,form</field>
            <field name="help" type="html">
                <p class="o_view_nocontent_smiling_face">
                    No anonymous messages yet
                </p>
                <p>
                    Anonymous messages from employees will appear here.<br/>
                    Sender identity is protected and cannot be revealed.
                </p>
            </field>
        </record>

        <record id="action_hr_anonymous_message_hr_view_list" model="ir.actions.act_window.view">
            <field name="sequence" eval="1"/>
            <field name="view_mode">list</field>
            <field name="view_id" ref="view_hr_anonymous_message_list_hr"/>
            <field name="act_window_id" ref="action_hr_anonymous_message_hr"/>
        </record>

        <record id="action_hr_anonymous_message_hr_view_form" model="ir.actions.act_window.view">
            <field name="sequence" eval="2"/>
            <field name="view_mode">form</field>
            <field name="view_id" ref="view_hr_anonymous_message_form_hr"/>
            <field name="act_window_id" ref="action_hr_anonymous_message_hr"/>
        </record>

        <record id="action_hr_anonymous_message_admin" model="ir.actions.act_window">
            <field name="name">All Messages (Admin)</field>
            <field name="res_model">hr.anonymous.message</field>
            <field name="view_mode">list,form</field>
            <field name="help" type="html">
                <p class="o_view_nocontent_smiling_face">
                    No anonymous messages
                </p>
                <p>
                    System administrator view with audit capabilities.
                </p>
            </field>
        </record>

        <record id="action_hr_anonymous_message_admin_view_list" model="ir.actions.act_window.view">
            <field name="sequence" eval="1"/>
            <field name="view_mode">list</field>
            <field name="view_id" ref="view_hr_anonymous_message_list_admin"/>
            <field name="act_window_id" ref="action_hr_anonymous_message_admin"/>
        </record>

        <record id="action_hr_anonymous_message_admin_view_form" model="ir.actions.act_window.view">
            <field name="sequence" eval="2"/>
            <field name="view_mode">form</field>
            <field name="view_id" ref="view_hr_anonymous_message_form_admin"/>
            <field name="act_window_id" ref="action_hr_anonymous_message_admin"/>
        </record>

        <!-- Menus -->
        <menuitem id="menu_anonymous_message_root" name="Anonymous HR" sequence="50"/>

        <menuitem id="menu_anonymous_message_employee"
                  name="My Messages"
                  parent="menu_anonymous_message_root"
                  action="action_hr_anonymous_message_employee"
                  sequence="10"/>

        <menuitem id="menu_anonymous_message_hr"
                  name="All Messages (HR)"
                  parent="menu_anonymous_message_root"
                  action="action_hr_anonymous_message_hr"
                  groups="hr.group_hr_user"
                  sequence="20"/>

        <menuitem id="menu_anonymous_message_admin"
                  name="System Admin"
                  parent="menu_anonymous_message_root"
                  action="action_hr_anonymous_message_admin"
                  groups="base.group_system"
                  sequence="30"/>

    </data>
</odoo>